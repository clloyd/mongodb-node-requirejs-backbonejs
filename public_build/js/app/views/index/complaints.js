define(["jquery","underscore","backbone","libs/jquery.peity","app_dir/collections/departments","jade!views_dir/index/templates/widget","jade!views_dir/index/templates/complaints","jade!views_dir/index/templates/complaint-pie"],function(e,t,n,r,i,s,o,u){var a=n.View.extend({el:"#complaints",events:{"click .widget-title":"loadDepartments"},initialize:function(){var e=s({title:"Complaints by Department",icon:"piechart",label:!1});this.$el.html(e),this.$(".widget-content").html(o()),this.collection=new i;var t=this;this.collection.fetch().success(function(e){t.renderdata({collection:e})})},loadDepartments:function(){n.history.navigate("#/departments",{trigger:!0})},renderdata:function(){var n=0;t.each(this.collection.models,function(e,t){n+=parseInt(e.get("complaints"))}),t.each(this.collection.models,function(e,t){var r=Math.floor(e.get("complaints")/n*100),i="",s=e.get("complaints")+"/"+n;r>=30?i="red":r>=25?i="yellow":i="green";var o=u({color:i,name:e.get("name"),value:s});this.$("ul").append(o)},this),t.each(this.$(".smallpie"),function(t){e(t).peity("pie",{colours:function(){return["#dddddd",this.getAttribute("data-colour")]},diameter:function(){return this.getAttribute("data-diameter")}})})}});return a});
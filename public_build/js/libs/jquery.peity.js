// Peity jQuery plugin version 0.6.0
// (c) 2011 Ben Pickles
//
// http://benpickles.github.com/peity/
//
// Released under MIT license.

(function(e,t){function i(e,n){var i=t.createElement("canvas");i.setAttribute("width",e*r),i.setAttribute("height",n*r);if(r!=1){var s="width:"+e+"px;height:"+n+"px";i.setAttribute("style",s)}return i}var n=e.fn.peity=function(r,i){return t.createElement("canvas").getContext&&this.each(function(){e(this).change(function(){var t=e.extend({},i),s=this;e.each(t,function(n,r){e.isFunction(r)&&(t[n]=r.call(s))});var o=e(this).html();n.graphers[r].call(this,e.extend({},n.defaults[r],t)),e(this).trigger("chart:changed",o)}).trigger("change")}),this};n.graphers={},n.defaults={},n.add=function(e,t,r){n.graphers[e]=r,n.defaults[e]=t};var r=window.devicePixelRatio||1;n.add("pie",{colours:["#FFF4DD","#FF9900"],delimeter:"/",diameter:16},function(t){var n=e(this),r=n.text().split(t.delimeter),s=parseFloat(r[0]),o=parseFloat(r[1]),u=-Math.PI/2,a=s/o*Math.PI*2,f=i(t.diameter,t.diameter),l=f.getContext("2d"),c=f.width/2;l.beginPath(),l.moveTo(c,c),l.arc(c,c,c,a+u,a==0?Math.PI*2:u,!1),l.fillStyle=t.colours[0],l.fill(),l.beginPath(),l.moveTo(c,c),l.arc(c,c,c,u,a+u,!1),l.fillStyle=t.colours[1],l.fill(),n.wrapInner(e("<span>").hide()).append(f)}),n.add("line",{colour:"#c6d9fd",strokeColour:"#4d89f9",strokeWidth:1,delimeter:",",height:16,max:null,min:0,width:32},function(t){var n=e(this),s=i(t.width,t.height),o=n.text().split(t.delimeter);o.length==1&&o.push(o[0]);var u=Math.max.apply(Math,o.concat([t.max])),a=Math.min.apply(Math,o.concat([t.min])),f=s.getContext("2d"),l=s.width,c=s.height,h=l/(o.length-1),p=c/(u-a),d=[],v;f.beginPath(),f.moveTo(0,c+a*p);for(v=0;v<o.length;v++){var m=v*h,g=c-p*(o[v]-a);d.push({x:m,y:g}),f.lineTo(m,g)}f.lineTo(l,c+a*p),f.fillStyle=t.colour,f.fill();if(t.strokeWidth){f.beginPath(),f.moveTo(0,d[0].y);for(v=0;v<d.length;v++)f.lineTo(d[v].x,d[v].y);f.lineWidth=t.strokeWidth*r,f.strokeStyle=t.strokeColour,f.stroke()}n.wrapInner(e("<span>").hide()).append(s)}),n.add("bar",{colour:"#4D89F9",delimeter:",",height:16,max:null,min:0,width:32},function(t){var n=e(this),s=n.text().split(t.delimeter),o=Math.max.apply(Math,s.concat([t.max])),u=Math.min.apply(Math,s.concat([t.min])),a=i(t.width,t.height),f=a.getContext("2d"),l=a.width,c=a.height,h=c/(o-u),p=r/2,d=(l+p)/s.length;f.fillStyle=t.colour;for(var v=0;v<s.length;v++){var m=v*d,g=c-h*(s[v]-u);f.fillRect(m,g,d-p,h*s[v])}n.wrapInner(e("<span>").hide()).append(a)})})(jQuery,document);